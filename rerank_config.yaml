model:
  mode: cross
  cross_name: BAAI/bge-reranker-v2-m3
  embedding_name: Qwen/Qwen3-Embedding-8B
  batch_size_cross: 32
  batch_size_bi: 64
  normalize_embeddings: true
  trust_remote_code: true
  # Advanced options for direct Transformers models (Qwen)
  dtype: "bfloat16"             # bf16 recommended on RTX 5090
  use_flash_attention: true     # if flash-attn available, otherwise ignored
  max_tokens: 16384             # 16k safe on 5090; 32k possible but reduce batch
  output_dimension: 1536        # e.g. 1024 (PCA down-projection). Leave null otherwise.

huggingface:
  token: null
  cache_dir: null
  model_dir: /app/models
  prefetch:
    - Qwen/Qwen3-Embedding-8B
    - BAAI/bge-reranker-v2-m3

server:
  host: 0.0.0.0
  port: 8000
  cors_origins: ["*"]
  api_keys:
    - change-me-123
  warmup:
    enabled: true
    load:
      cross: true       # load the cross-encoder (reranker)
      bi: false         # load the bi-encoder (if using "bi" mode)
      embedding: true   # load the embedding model used by /v1/encode
    texts: ["warmup", "test"]  # small texts for a forward pass

security:
  brute_force:
    enabled: true
    max_failures: 5
    window_seconds: 60
    ban_seconds: 300
    ban_file: "/app/banned_ips.json" # MUST be an absolute path
    trust_proxy_headers: true # Assuming user might have a reverse proxy as they asked about it, but defaulting to safe or what they asked? They asked "beware take the case of a reverse proxy in front". I will set it to false by default in code but here I will set it to false and let them know, or set to true if they imply they HAVE a reverse proxy. The user said "take the case of a reverse proxy in front", so I should probably enable it or at least document it well. I will set it to false for safety but add a comment. Actually, if I set it to `true` and there is NO proxy, a user can spoof XFF headers. So `false` is safer by default. The user asked to handle the case, so I will add the option.
    # trust_proxy_headers: false # Set to true to use X-Forwarded-For / X-Real-IP

logging:
  level: DEBUG
  format: json    # json or text
  file: /logs/rerank.log      # null -> stdout (container logs)